
#Область ОбработчикиСобытийФормы

// Обработчик события возникающего на сервере при создании формы.
//
// Параметры:
//  Отказ                - Булево - Признак отказа от создания формы.
//  СтандартнаяОбработка - Булево - В данный параметр передается признак выполнения системной обработки события.
//
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("ГрафикАренды", ГрафикАренды) Тогда
		
		ДатаНачала = НачалоГода(ТекущаяДатаСеанса());
		ДатаОкончания = ДобавитьМесяц(ДатаНачала, 120) - 1;
		Значение = 1;
		
	Иначе 
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ЗаполнитьГрафик(Команда)
	Если ГрафикАренды.Пустая()
		ИЛИ Значение = 0 
		ИЛИ ДатаОкончания <= ДатаНачала Тогда
		Возврат;
	КонецЕсли;
	
	ЗаполнитьГрафикНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьГрафикНаСервере()
	
	ТекущаяДата = ДатаНачала;
	
	НаборЗаписей = РегистрыСведений.ГрафикПериодовАренды.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.ГрафикАренды.Установить(ГрафикАренды);
	
	Пока ТекущаяДата < ДатаОкончания  Цикл
		
		НоваяСтрока = НаборЗаписей.Добавить();
		НоваяСтрока.Дата = ТекущаяДата;
		НоваяСтрока.ГрафикАренды = ГрафикАренды;
		НоваяСтрока.Значение = Значение;
		
		ТекущаяДата = КонецДня(ТекущаяДата) + 1;
		
	КонецЦикла;
	
	НаборЗаписей.Записать();
	
КонецПроцедуры

#КонецОбласти