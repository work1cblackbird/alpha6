
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Пропускаем инициализацию, чтобы гарантировать получение формы при передаче параметра "АвтоТест".
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	Параметры.Свойство("Идентификатор", Идентификатор);
	
	Заголовок = НСтр("ru='Оборудование:'") + Символы.НПП  + Строка(Идентификатор);
	
	времБазаТоваров  = Неопределено;
	времФайлОтчета   = Неопределено;
	времФлагВыгрузки = Неопределено;
	времФорматОбмена = Неопределено;
	
	Параметры.ПараметрыОборудования.Свойство("ФорматОбмена", времФорматОбмена);
	Параметры.ПараметрыОборудования.Свойство("БазаТоваров", времБазаТоваров);
	Параметры.ПараметрыОборудования.Свойство("ФайлОтчета", времФайлОтчета);
	Параметры.ПараметрыОборудования.Свойство("ФлагВыгрузки",времФлагВыгрузки);
	
	ФорматОбмена = ?(времФорматОбмена = Неопределено, 0, времФорматОбмена);
	БазаТоваров = ?(времБазаТоваров = Неопределено, "", времБазаТоваров);
	ФайлОтчета  = ?(времФайлОтчета = Неопределено, "", времФайлОтчета);
	ФлагВыгрузки = ?(времФлагВыгрузки = Неопределено, "", времФлагВыгрузки);
	
	Драйвер = НСтр("ru='Не требуется'");
	Версия  = НСтр("ru='Не определена'");
	
	МенеджерОфлайнОборудованияПереопределяемый.ФормаНастройкиОфлайнОборудованияПриСозданииНаСервере(ЭтотОбъект, Идентификатор);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	МенеджерОфлайнОборудованияКлиентПереопределяемый.ФормаНастройкиОфлайнОборудованияПриОткрытии(ЭтотОбъект, Идентификатор);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ЗаписатьИЗакрыть(Команда)
	
	ТекстОшибки = "";
	ТекстОшибкиОбщий = "";

	Если ПустаяСтрока(БазаТоваров) Тогда
		Результат = Ложь;
		ТекстОшибкиОбщий = НСтр("ru='Файл базы товаров не указан.'");
	КонецЕсли;
	
	Если ПустаяСтрока(ФайлОтчета) Тогда
		Результат = Ложь;
		ТекстОшибкиОбщий = ТекстОшибкиОбщий + ?(ПустаяСтрока(ТекстОшибкиОбщий), "", Символы.ПС); 
		ТекстОшибкиОбщий = ТекстОшибкиОбщий + НСтр("ru='Файл отчета не указан.'") 
	КонецЕсли;
	
	Если ПустаяСтрока(ТекстОшибкиОбщий) Тогда
		
		НовыеЗначениеПараметров = Новый Структура;
		НовыеЗначениеПараметров.Вставить("ФорматОбмена", ФорматОбмена);
		НовыеЗначениеПараметров.Вставить("БазаТоваров", БазаТоваров);
		НовыеЗначениеПараметров.Вставить("ФайлОтчета", ФайлОтчета);
		НовыеЗначениеПараметров.Вставить("ФлагВыгрузки", ФлагВыгрузки);
		
		Результат = Новый Структура;
		Результат.Вставить("Идентификатор", Идентификатор);
		Результат.Вставить("ПараметрыОборудования", НовыеЗначениеПараметров);
		
		МенеджерОфлайнОборудованияКлиентПереопределяемый.ФормаНастройкиОфлайнОборудованияПриСохраненииПараметров(
			ЭтотОбъект,
			Идентификатор,
			НовыеЗначениеПараметров
		);
		
		Закрыть(Результат);
		
	Иначе
		ОчиститьСообщения();
		ОбщегоНазначенияКлиент.СообщитьПользователю(НСтр("ru= 'При проверке были обнаружены следующие ошибки:'")+ Символы.ПС + ТекстОшибкиОбщий);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти