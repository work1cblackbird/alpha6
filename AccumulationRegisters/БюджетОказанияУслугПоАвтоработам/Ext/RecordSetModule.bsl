// Модуль набора записей регистра накоплений "Бюджет оказания услуг по автоработам"

#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОписаниеПеременных

Перем ПодразделениеКомпании Экспорт; // Подразделение компании
Перем ДокументОбъект Экспорт;        // Документ объект
Перем РежимПроведения Экспорт;       // Режим проведения документа оперативный/неоперативный

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

// Функция выполняющая приход
Функция Приход() Экспорт
	
	// Получим документ, по которому будем делать записи в регистр
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	БюджетОказанияУслугПоАвтоработам.Ссылка.ПодразделениеКомпании,
	|	БюджетОказанияУслугПоАвтоработам.Ссылка.СценарийПланирования,
	|	БюджетОказанияУслугПоАвтоработам.Авторабота КАК Авторабота,
	|	БюджетОказанияУслугПоАвтоработам.Количество,
	|	БюджетОказанияУслугПоАвтоработам.СуммаВсегоУпр КАК СуммаУпр,
	|	БюджетОказанияУслугПоАвтоработам.СуммаВсегоУпр * &Коэффициент КАК СуммаРег,
	|	БюджетОказанияУслугПоАвтоработам.СуммаНДС КАК СуммаНДС,
	|	БюджетОказанияУслугПоАвтоработам.Ссылка.ДатаПланирования КАК Период
	|ИЗ
	|	Документ.БюджетОказанияУслугПоАвтоработам.Автоработы КАК БюджетОказанияУслугПоАвтоработам
	|ГДЕ
	|	БюджетОказанияУслугПоАвтоработам.Ссылка = &Ссылка";
	
	// Найдем коэффициент пересчета из управленческой валюты в валюту регл.учета
	Коэффициент = РаботаСКурсамиВалютПлатформа.ПолучитьКоэффициентПересчетаВалют(ДокументОбъект.Дата);
	
	Запрос.УстановитьПараметр("Ссылка"      , ДокументОбъект);
	Запрос.УстановитьПараметр("Коэффициент" , Коэффициент);

	Загрузить(Запрос.Выполнить().Выгрузить());
		
	ДокументОбъект = Неопределено;
	
	Возврат Истина;
	
КонецФункции

#КонецОбласти

#КонецЕсли