// Модуль набора записей регистра "Допроведение по партиям"

#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда


#Область ОписаниеПеременных

Перем ДокументОбъект Экспорт;    // ДокументОбъект.
Перем ШапкаДокумента Экспорт;    // Выборка из запроса по реквизитам документа
Перем НеПроводитьПартии Экспорт; // Булево. Истина-документ не надо допроводить по партиям

#КонецОбласти

#Область ПрограммныйИнтерфейс

// Зафиксировать
// 
// Возвращаемое значение:
//  Булево - Признак возможности дальнейшей обработки события.
//
Функция Зафиксировать() Экспорт
	// Проверим надо ли фиксировать непроведение партий
	НеПроводитьПартии=Ложь;
	ОтложенноеПроведениеПоПартиям=Ложь;
	
	// Определим режим проведения по партиям
	ОтложенноеПроведениеПоПартиям = (ОбработкаСобытийДокументаСервер.ПолучитьРежимПроведенияПоПартиям() = Перечисления.РежимыПроведенияПартий.ПартииОтсутствуют);
	Если НЕ (ДокументОбъект.Ссылка=ШапкаДокумента.Ссылка И ОтложенноеПроведениеПоПартиям) Тогда
		ШапкаДокумента=Неопределено;
		ДокументОбъект=Неопределено;
		Возврат Истина;
	КонецЕсли;
	
	// Зафиксируем, что документ надо допровести
	НоваяЗапись=Добавить();
	НоваяЗапись.Период=ШапкаДокумента.Дата;
	НоваяЗапись.Регистратор=ШапкаДокумента.Ссылка;
	НоваяЗапись.ПодразделениеКомпании=ШапкаДокумента.ПодразделениеКомпании;
	
	НеПроводитьПартии=Истина;
	
	ШапкаДокумента=Неопределено;
	ДокументОбъект=Неопределено;
	
	Возврат Истина;
КонецФункции

#КонецОбласти

#Область ОбработчикиСобытий

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	Если НЕ ОбработкаСобытийРегистраСервер.ОбработкаПроверкиЗаполнения(ЭтотОбъект, Отказ, ПроверяемыеРеквизиты) Тогда
		
		Возврат;
		
	КонецЕсли;
	
КонецПроцедуры 

#КонецОбласти

#КонецЕсли