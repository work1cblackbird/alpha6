
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныеПроцедурыИФункции

Процедура ЗаписатьГрафикПоставок(Документ, ВыборкаСтрок) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	НаборЗаписейГрафикПоставок = РегистрыСведений.ГрафикПоставок.СоздатьНаборЗаписей();
	НаборЗаписейГрафикПоставок.Отбор.ЗаказПокупателя.Установить(Документ);
	
	Пока ВыборкаСтрок.Следующий() Цикл
		КоличествоЗаказа    = ВыборкаСтрок.КоличествоЗаказа;
		Выборка = ВыборкаСтрок.Выбрать(ОбходРезультатаЗапроса.Прямой);
		Пока Выборка.Следующий() Цикл
			Если КоличествоЗаказа <= 0 Тогда
				Прервать;
			КонецЕсли;
			Если Выборка.Количество = 0 Тогда
				Продолжить;
			КонецЕсли;
			Количество = Мин(Выборка.Количество, КоличествоЗаказа);
			Запись = НаборЗаписейГрафикПоставок.Добавить();
			Запись.ЗаказПокупателя            = Документ;
			Запись.ИдентификаторСтроки        = Выборка.ИдентификаторСтроки;
			Запись.Номенклатура               = Выборка.Номенклатура;
			Запись.ХарактеристикаНоменклатуры = Выборка.ХарактеристикаНоменклатуры;
			Запись.Количество                 = Количество;
			Запись.ДатаПоставки               = Выборка.ДатаПоставки;
			Запись.Контрагент                 = Выборка.Контрагент;
			Запись.ДатаПоступления            = Выборка.ДатаПоступления;
			Запись.Информация                 = Выборка.Информация;
			КоличествоЗаказа = КоличествоЗаказа - Количество;
		КонецЦикла;
	КонецЦикла;
	
	НаборЗаписейГрафикПоставок.Записать();
	
КонецПроцедуры

#Область ПараметрыОбработкиРеквизитовОбъекта

Функция ПолучитьОбязательныеРеквизиты(Объект) Экспорт
	
	ОбязательныеРеквизиты = ОбработкаСобытийРегистраСервер.ПолучитьСтандартныеОбязательныеРеквизиты(Объект);
	
	Возврат ОбязательныеРеквизиты;
	
КонецФункции 

Функция ПолучитьУникальныеРеквизиты(Объект) Экспорт
	
	УникальныеРеквизиты = Новый Структура();
	
	Возврат УникальныеРеквизиты;
	
КонецФункции 

#КонецОбласти

#КонецОбласти

#КонецЕсли