
#Область СлужебныйПрограммныйИнтерфейс

// Проверка на корректность е-мейл адресов указанных в письме.
// В случае, если адрес в списках не корректен, то данный адрес исключается из списка
//
// Параметры:
//  ПисьмоОбъект  - <Документ.ЭлектронноеПисьмоИсходящее> - Электронное письмо,
//                                                          которое нужно очистить от не корректных е-мейл.
//
Процедура ОчиститьСписокАдресатов(ПисьмоОбъект) Экспорт

	Инд = 1;
	Пока Инд <=3 Цикл
		
		Если      Инд = 1 Тогда
			ТЧ 	= "ПолучателиПисьма";
		ИначеЕсли Инд = 2 Тогда
			ТЧ 	= "ПолучателиКопий";
		ИначеЕсли Инд = 3 Тогда
			ТЧ 	= "ПолучателиОтвета";
		КонецЕсли; 	
		
		СписокПолучателей 	= ПисьмоОбъект[ТЧ].Выгрузить();
		Для каждого Получатель Из СписокПолучателей Цикл
			Если НЕ ОбщегоНазначенияКлиентСервер.АдресЭлектроннойПочтыСоответствуетТребованиям(Получатель.Адрес) Тогда
				СписокПолучателей.Удалить(Получатель);
			КонецЕсли; 
		КонецЦикла;
		
		ПисьмоОбъект[ТЧ].Загрузить(СписокПолучателей);
		
		Если ПисьмоОбъект.ПолучателиПисьма.Количество() = 0 Тогда
			Возврат;
		КонецЕсли;
		
		Инд = Инд +1;
	КонецЦикла; 
	
	СписокПолучателей    		= ОбщегоНазначенияКлиентСервер.АдресаЭлектроннойПочтыИзСтроки(ПисьмоОбъект.СписокПолучателейСкрытыхКопий);
	СписокПолучателейОчищенный 	= "";
	Для каждого Получатель Из СписокПолучателей Цикл
		Если ОбщегоНазначенияКлиентСервер.АдресЭлектроннойПочтыСоответствуетТребованиям(Получатель.Адрес) Тогда
			СписокПолучателейОчищенный = СписокПолучателейОчищенный + Получатель.Адрес +"; ";
		КонецЕсли; 
	КонецЦикла;
	ПисьмоОбъект.СписокПолучателейСкрытыхКопий = СписокПолучателейОчищенный;
	
КонецПроцедуры // ОчиститьСписокАдресатов()

#КонецОбласти

