#Область ОбработчикиСобытий

// Обработчик события нажатия кнопки "История аренды клиента".
//
// Параметры:
//  ПараметрКоманды - Произвольный - В параметр передается значение от источника, в котором реализована команда
//  ПараметрыВыполненияКоманды - ПараметрыВыполненияКоманды - В обработчике команды можно изменить
//  значение свойств параметра Окно и Уникальность. 
//
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	Если ПараметрКоманды = Неопределено ИЛИ ПараметрКоманды.Пустая() Тогда
		Возврат;
	КонецЕсли;
	
	Контрагенты = Новый СписокЗначений;
	Если ТипЗнч(ПараметрКоманды) = Тип("СправочникСсылка.Контрагенты") Тогда
		Контрагенты.Добавить(ПараметрКоманды);
	Иначе
		Реквизиты = ЗначенияРеквизитовОбъекта(ПараметрКоманды, "Заказчик,Контрагент");
		Контрагенты.Добавить(Реквизиты.Заказчик);
		Если Контрагенты.НайтиПоЗначению(Реквизиты.Контрагент) = Неопределено Тогда
			Контрагенты.Добавить(Реквизиты.Контрагент);
		КонецЕсли;
	КонецЕсли;
	
	// фильтры
	ОтчетОтбор = Новый Структура;
	ОтчетОтбор.Вставить("ЗаявкаНаАренду_Заказчик",   Контрагенты);
	ОтчетОтбор.Вставить("ЗаявкаНаАренду_Контрагент", Контрагенты);
	ОтчетОтбор.Вставить("ДоговорАренды_Заказчик",    Контрагенты);
	ОтчетОтбор.Вставить("ДоговорАренды_Контрагент",  Контрагенты);

	ОткрытьФорму(
		"Отчет.ИсторияАренды.Форма", 
		Новый Структура("Отбор,КлючВарианта,СформироватьПриОткрытии", ОтчетОтбор, "Основной", Истина), 
		ПараметрыВыполненияКоманды.Источник, 
		ПараметрыВыполненияКоманды.Уникальность,
		ПараметрыВыполненияКоманды.Окно
	);

	 
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Функция ЗначенияРеквизитовОбъекта(ПараметрКоманды, Реквизиты)
	
	Возврат ОбщегоНазначения.ЗначенияРеквизитовОбъекта(ПараметрКоманды, "Заказчик,Контрагент");
	
КонецФункции

#КонецОбласти
